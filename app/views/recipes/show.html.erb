<div class="uk-child-width-1-1@m" uk-grid>
  <div>
    <div class="uk-background-cover uk-height-medium uk-panel uk-flex uk-flex-center uk-flex-middle uk-background-fixed" uk-parallax="blur: 4" style="background-image: url(<%= url_for(@recipe.image.variant resize: '1000x1000') %>;"></div>
  </div>
</div>


<div class="uk-section uk-section-secondary uk-light">
    <div class="uk-container">
        <h2 class="title"><%= @recipe.title %></h2>
        <p><%= @recipe.description %></p>
        <div class="uk-child-width-1-3@m" uk-grid>
          <div>
            <div class="uk-text-center">
              <h5 class="title"><%= t("recipe.title.score_with_count", count: @recipe.score_count) %></h5>
              <% if @recipe.score_count > 0 %>
                <p><%= @recipe.score %> / 5</p>
              <% else %>
                <p><%= t("recipe.title.no_score") %></p>
              <% end %>
            </div>
          </div>
          <div>
            <div class="uk-text-center">
              <h5 class="title"><%= t("recipe.title.time") %></h5>
              <p><%= minute_to_time(@recipe.cooking_time + @recipe.preparation_time) %></p>
            </div>
          </div>
          <div>
            <div class="uk-text-center">
              <h5 class="title"><%= t("recipe.title.difficulty") %></h5>
              <progress id="js-progressbar" class="uk-progress" value="<%= @recipe.difficulty %>" max="10"></progress>
            </div>
          </div>          
        </div>
    </div>
</div>

<div class="uk-section uk-section-default">
  <div class="uk-child-width-1-2@m" uk-grid>
    <div>
      <div class="uk-padding">
        <h2 class="title"><%= t("recipe.title.ingredient") %></h2>
        <div class="uk-card uk-card-default uk-card-body">
          <%@recipe.recipe_ingredients.each do |recipe_ingredient| %>
              <div class="uk-grid-small" uk-grid>
                  <div class="uk-width-expand" uk-leader="fill: -"><%= recipe_ingredient.ingredient.name %></div>
                  <% if (recipe_ingredient.recipe_quantity) %>
                    <div><%= recipe_ingredient.recipe_quantity.value %> <%= recipe_ingredient.recipe_quantity.quantity_type.name %></div>
                  <% end %>
              </div>
          <% end %>
        </div>
      </div>
      <div  class="uk-padding">
        <h2 class="title"><%= t("recipe.title.ustensil") %></h2>
        <div class="uk-card uk-card-default uk-card-body">
          <ul>
          <%@recipe.utensils.each do | ustensile| %>
            <li> <%= ustensile.title %></li>
          <% end %>
          </ul>
        </div>
      </div>
    </div>
    <div>
      <div class="uk-container uk-padding">
        <h2 class="title"><%= t("recipe.title.preparation") %></h2>
        <div class="uk-card uk-card-default uk-card-body">
          <ul class="uk-list uk-list-bullet">
              <% @recipe.steps.each do |step| %>
                <li><%= step %></li>
              <% end %>
          </ul>
          <div class="uk-grid-small" uk-grid>
            <div class="uk-width-expand" uk-leader="fill: -"><%= t("recipe.title.preparation_time") %></div>
            <div><%= minute_to_time(@recipe.preparation_time) %></div>
          </div>
          <div class="uk-grid-small" uk-grid>
            <div class="uk-width-expand" uk-leader="fill: -"><%= t("recipe.title.cooking_time") %></div>
            <div><%= minute_to_time(@recipe.cooking_time) %></div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <hr class="uk-divider-icon">
  <p id="notice"><%= notice %></p>
  <%  if flash[:success] %>
    <div class="uk-alert-success" uk-alert>
      <a class="uk-alert-close" uk-close></a>
      <p><%= flash[:success] %></p>
    </div>
  <% end %>
  <div class="uk-container">
    <div class="uk-flex uk-flex-middle uk-padding uk-padding-remove-left uk-padding-remove-right">
      <div>
        <h2 class="title uk-margin-remove-bottom"><%= t("recipe.title.all_feedback") %></h2>
      </div>
      <div class="uk-padding uk-padding-remove-top uk-padding-remove-bottom">
          <% if user_signed_in? %>
            <a class="uk-button uk-button-default uk-button-small" href="#feedback" uk-toggle><%= t('recipe.action.give_feedback') %></a>
          <% else %>
            <a class="uk-link-muted" href="<%= new_user_session_path(:next => request.original_url) %>"><%= t('recipe.title.connect_to_give_feedback') %></a>
          <% end %>
      </div>
    </div>
    <% if @recipe_feedbacks.length < 1 %>
      <p><%= t('recipe.title.no_feedback') %></p>
    <% else %>
      <% @recipe_feedbacks.each do |recipe_feedback| %>
        <hr>
        <article class="uk-comment">
          <header class="uk-comment-header uk-grid-medium uk-flex-middle" uk-grid>
              <% if recipe_feedback.user.avatar.attached? %>
                <div class="uk-width-auto">
                    <img class="uk-comment-avatar" src="<%= url_for(recipe_feedback.user.avatar.variant resize: '200x200') %>" width="50" height="50" alt="">
                </div>
              <% end %>
              <div class="uk-width-expand">
                  <h4 class="uk-comment-title uk-margin-remove"><a class="uk-link-reset" href="#"><%= recipe_feedback.user.email %></a></h4>
                  <ul class="uk-comment-meta uk-subnav uk-subnav-divider uk-margin-remove-top">
                      <li><%= recipe_feedback.updated_at.to_time.strftime('%d/%m/%Y %H:%M') %></li>
                      <% if recipe_feedback.value %>
                        <li><%= recipe_feedback.value %> / 5</li>
                      <% end %>
                  </ul>
              </div>
          </header>
          <% if recipe_feedback.content %>
            <div class="uk-comment-body">
              <p><%= recipe_feedback.content %></p>
            </div>
          <% end %>
      </article>
      <% end %>
    <% end %>
  </div>
</div>

<div id="feedback" class="uk-modal-container" uk-modal>
    <div class="uk-modal-dialog uk-modal-body uk-margin-auto-vertical uk-modal-dark">
        <button class="uk-modal-close-outside" type="button" uk-close></button>
        <h2 class="uk-modal-title landing-title"><%= t('recipe.title.give_feedback_for', recipe_title: @recipe.title) %></h2>
        <%= simple_form_for :recipe_score,
            url: recipe_feedback_path(:recipe_id => @recipe.id),
            :method => :post,
            defaults: {
              wrapper: false,
              label: false
            } do |f| %>
          <div class="uk-margin">
            <%= f.input :value, :prompt => t("recipe.title.score"), :selected => (@feedback_user) ? @feedback_user.value : nil, collection: 0..5, as: :select, input_html: { class: 'uk-select' } %>
          </div>
          <div class="uk-margin">
            <%= f.text_area :content, :label => t("recipe.title.comment"), :prompt => t("recipe.title.comment"), :value => (@feedback_user) ? @feedback_user.content: nil, class: 'uk-textarea' %>
          </div>
          <div>
            <%= f.button :submit, t("recipe.action.feedback") %>
          </div>
        <% end %>
    </div>
</div>